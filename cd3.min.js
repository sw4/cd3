var cd3={list:[],updateDomain:function(a,c,b){("x"===c?a.cd3.d3xScale:a.cd3.d3yScale).domain(b||a.cd3[c].scale&&a.cd3[c].scale.domain||d3.extent(a.cd3.resampling?this.resampleData(a):a.cd3.data,function(b){return b[a.cd3[c].source]}))},updateRange:function(a,c,b){("x"===c?a.cd3.d3xScale:a.cd3.d3yScale).range(b||a.cd3[c].scale&&a.cd3[c].scale.range||("x"===c?[0,a.cd3.width]:[a.cd3.height,0]))},updateTicks:function(a){a.cd3.d3yAxis.ticks(Math.max(a.cd3.height/20,2));a.cd3.d3xAxis.ticks(Math.max(a.cd3.width/
130,2))},refactorData:function(a,c){c=c||a.cd3.data;"time"==a.cd3.x.scale.type&&(c=c.slice(),c.sort(function(a,c){return a.time-c.time}));return c},resampleData:function(a){dataPerPixel=a.cd3.data.length/a.cd3.width;return a.cd3.data.filter(function(a,b){return 0==b%Math.ceil(dataPerPixel)})},bisectData:function(a,c){var b=d3.bisector(function(b){return b[a.cd3.x.source]}).right;return b(a.cd3.data,c)},updateScale:function(a){a.cd3.d3parentSvg.attr("width",a.cd3.width+a.cd3.margin.left+a.cd3.margin.right).attr("height",
a.cd3.height+a.cd3.margin.top+a.cd3.margin.bottom);a.cd3.d3graphSvg.attr("width",a.cd3.width).attr("height",a.cd3.height).attr("transform","translate("+a.cd3.margin.left+","+a.cd3.margin.top+")");a.cd3.d3graphXAxis.attr("class","x axis").attr("transform","translate(0,"+a.cd3.height+")").call(a.cd3.d3xAxis);a.cd3.d3graphYAxis.attr("class","y axis").call(a.cd3.d3yAxis);a.cd3.d3graphTitle&&a.cd3.d3graphTitle.attr("x",a.cd3.width/2).attr("y",a.cd3.margin.top/2).attr("class","title")},updateDimensions:function(a){a.cd3.width=
parseInt(a.style("width"));a.cd3.height=parseInt(a.style("height"));"object"!==typeof a.cd3.margin&&(a.cd3.margin={top:a.cd3.margin,left:a.cd3.margin,right:a.cd3.margin,bottom:a.cd3.margin});a.cd3.width=a.cd3.width-a.cd3.margin.left-a.cd3.margin.right;a.cd3.height=a.cd3.height-a.cd3.margin.top-a.cd3.margin.bottom;a.cd3.tips&&a.cd3.d3TipOverlay&&a.cd3.d3TipOverlay.attr("width",a.cd3.width).attr("height",a.cd3.height)},tips:function(a){var c=this,b=[];a.cd3.series.forEach(function(c){c.d3Tip=a.cd3.d3graphSvg.append("circle").attr("display",
"none").attr("r",4.5).attr("class","tip "+c.cssClass);b.push(c.d3Tip)});a.cd3.d3TipOverlay=a.cd3.d3graphSvg.append("rect").attr("class","tipOverlay").attr("width",a.cd3.width).attr("height",a.cd3.height).on("mouseover",function(){a.cd3.d3TipInfo=d3.select("body").append("div").attr("class","cd3 tipInfo").html();a.cd3.data&&1<a.cd3.data.length&&b.forEach(function(a){a.style("display","block")});a.cd3.d3TipInfo.style("display","block")}).on("mouseout",function(){a.cd3.data&&1<a.cd3.data.length&&b.forEach(function(a){a.style("display",
"none")});a.cd3.d3TipInfo.style("display","none")}).on("mousemove",function(){var b=d3.mouse(this);if(!a.cd3.data||1>a.cd3.data.length)return!1;var d=a.cd3.d3xScale.invert(b[0]),e=c.bisectData(a,d),g=data[e-1],h=data[e];if(!g||!h)return!1;var l=h[a.cd3.x.source]-g[a.cd3.x.source],k=(a.cd3.x.title?a.cd3.x.title:a.cd3.x.source)+":"+(a.cd3.x.scale.format?a.cd3.x.scale.format(a.cd3.d3xScale.invert(b[0])):a.cd3.d3xScale.invert(b[0]));a.cd3.series.forEach(function(c){var e=d3.interpolateNumber(g[c.source],
h[c.source])((d-g[a.cd3.x.source])/l);c.d3Tip.attr("cx",b[0]).attr("cy",a.cd3.d3yScale(e));k+=" <span class='"+c.cssClass+" "+c.source+"'>"+(c.title?c.title:c.source)+":"+e.toFixed(2)+"</span>"});e=parseInt(a.style("width"));a.cd3.d3TipInfo.style("top",b[1]+a.cd3.margin.top+10+"px");b[0]>e/2?a.cd3.d3TipInfo.style("right",e-b[0]-a.cd3.margin.right+10+"px").style("left","auto"):a.cd3.d3TipInfo.style("left",b[0]+a.cd3.margin.right+20+"px").style("right","auto");a.cd3.d3TipInfo.html(k)})},chart:function(a){var c=
this,b=d3.select(a.selector);b.cd3=a;c.refactorData(b);b.cd3.animate&&b.cd3.animate.ease||(b.cd3.animate.ease="linear");b.cd3.animate&&null!==b.cd3.animate.duration||(b.cd3.animate.duration=200);null===b.cd3.resampling&&(b.cd3.resampling=!0);c.updateDimensions(b);b.cd3.d3xScale={};b.cd3.d3yScale={};b.cd3.d3xAxis=d3.svg.axis();b.cd3.d3yAxis=d3.svg.axis();switch(b.cd3.x.scale.type){case "time":b.cd3.d3xScale=d3.time.scale();b.cd3.x.scale.format||(b.cd3.x.scale.format="%I:%M:%S");break;default:case "linear":b.cd3.d3xScale=
d3.scale.linear()}c.updateDomain(b,"x");c.updateRange(b,"x");b.cd3.d3xAxis.orient(b.cd3.x.axis&&b.cd3.x.axis.orient||"bottom");b.cd3.d3xAxis.scale(b.cd3.d3xScale);b.cd3.x.scale.format&&b.cd3.d3xAxis.tickFormat(d3.time.format(b.cd3.x.scale.format));switch(b.cd3.y.scale.type){case "time":b.cd3.d3yScale=d3.time.scale();b.cd3.y.scale.format||(b.cd3.y.scale.format="%I:%M:%S");b.cd3.d3yScale.tickFormat(d3.time.format(b.cd3.y.scale.format));break;default:case "linear":b.cd3.d3yScale=d3.scale.linear()}c.updateDomain(b,
"y");c.updateRange(b,"y");b.cd3.d3yAxis.orient(b.cd3.y.axis&&b.cd3.y.axis.orient||"left");b.cd3.d3yAxis.scale(b.cd3.d3yScale);c.updateTicks(b);b.cd3.d3parentSvg=b.attr("class","cd3").append("svg");b.cd3.d3graphSvg=b.cd3.d3parentSvg.append("g").attr("position","relative");b.cd3.d3graphXAxis=b.cd3.d3graphSvg.append("g");b.cd3.d3graphYAxis=b.cd3.d3graphSvg.append("g");b.cd3.d3graphTitle=b.cd3.title?b.cd3.d3parentSvg.append("text").text(b.cd3.title):null;b.cd3.d3graphLegend=b.append("div").attr("class",
"legend");b.cd3.tips&&c.tips(b);c.updateScale(b);b.cd3.series.forEach(function(a,d){switch(a.type){default:case "line":a.line=d3.svg.line().x(function(a,c){return b.cd3.d3xScale(a[b.cd3.x.source])}).y(function(c,d){return b.cd3.d3yScale(c[a.source])}),a.path=b.cd3.d3graphSvg.append("g").append("path").data(b.cd3.resampling?[c.resampleData(b)]:[b.cd3.data]).attr("class","line path "+(a.cssClass||a.source)).attr("d",a.line)}b.cd3.d3graphLegend.html(b.cd3.d3graphLegend.html()+"<span class="+(a.cssClass||
a.source)+">"+(a.title||"series"+d)+"</span>")});c.list.push(b);return b},update:function(a,c){if(!c)return!1;var b=a.cd3.data,f=c.slice(),f=this.refactorData(a,f),d=f.length-b.length,e=0>d?b.length+=d:b.length;0>d?(d*=-1,b.splice(b.length-d,d)):0<d&&f.splice(f.length-d,d).forEach(function(a){b.push(a)});for(d=0;d<e;d++)b[d]=f[d];this.updateData(a)},updateData:function(a){this.updateDomain(a,"x");this.updateDomain(a,"y");a.cd3.series.forEach(function(c){c.path.attr("transform",null).transition().duration(a.cd3.animate.duration).ease(a.cd3.animate.ease).attr("d",
c.line)});a.cd3.d3graphYAxis.transition().duration(a.cd3.animate.duration).ease(a.cd3.animate.ease).call(a.cd3.d3yAxis);a.cd3.d3graphXAxis.transition().duration(a.cd3.animate.duration).ease(a.cd3.animate.ease).call(a.cd3.d3xAxis)},resize:function(){var a=cd3;a.list.forEach(function(c){if(!c.cd3.resizable)return!1;a.updateDimensions(c);a.updateRange(c,"x");a.updateRange(c,"y");a.updateScale(c);a.updateTicks(c);a.update(c,c.cd3.data)})}};d3.select(window).on("resize",cd3.resize);