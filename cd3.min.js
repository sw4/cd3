var cd3={list:[],stringToColor:function(a){var b=0;a+=Math.floor(111111*Math.random());for(var c=0;c<a.length;c++)b=a.charCodeAt(c)+((b<<5)-b);a="#";for(c=0;3>c;c++)a+=("00"+(b>>8*c&255).toString(16)).substr(-2);return a},updateDomain:function(a,b,c){var d="x"===b?a.cd3.d3xScale:a.cd3.d3yScale;!c&&a.cd3[b].scale&&a.cd3[b].scale.domain?c=a.cd3[b].scale.domain:!c&&a.cd3[b].scale&&"ordinal"==a.cd3[b].scale.type?c=a.cd3.data.map(function(c){return c[a.cd3[b].source]}):c||(c=d3.extent(a.cd3.resampling?
this.resampleData(a):a.cd3.data,function(c){return c[a.cd3[b].source]}));d.domain(c)},updateRange:function(a,b,c){var d="x"===b?a.cd3.d3xScale:a.cd3.d3yScale;!c&&a.cd3[b].scale&&a.cd3[b].scale.range?d.range(a.cd3[b].scale.range):!c&&a.cd3[b].scale&&"ordinal"==a.cd3[b].scale.type?0<a.cd3.series.length&&"column"==a.cd3.series[0].type?d.rangeBands([0,a.cd3.width]):0<a.cd3.series.length&&"bar"==a.cd3.series[0].type?d.rangeBands([0,a.cd3.height]):d.rangePoints([0,a.cd3.width]):c||d.range("x"===b?[0,a.cd3.width]:
[a.cd3.height,0])},updateTicks:function(a){function b(b){var d=a.cd3[b].axis&&a.cd3[b].axis.ticks&&a.cd3[b].axis.ticks.rotate||0,h=a.cd3[b].axis&&a.cd3[b].axis.ticks&&a.cd3[b].axis.ticks.top||null;b="x"==b?a.cd3.d3graphXAxis.selectAll(".tick text"):a.cd3.d3graphYAxis.selectAll(".tick text");b.attr("transform",function(a){return"rotate("+d+")"});h&&b.attr("dy",h)}a.cd3.d3yAxis.ticks(Math.max(a.cd3.height/20,2));b("x");a.cd3.d3xAxis.ticks(Math.max(a.cd3.width/130,2));b("y")},refactorData:function(a,
b){b=b||a.cd3.data;"time"==a.cd3.x.scale.type&&(b=b.slice(),b.sort(function(a,b){return a.time-b.time}));return b},resampleData:function(a){dataPerPixel=a.cd3.data.length/a.cd3.width;return a.cd3.data.filter(function(a,c){return 0==c%Math.ceil(dataPerPixel)})},bisectData:function(a,b){var c=d3.bisector(function(b){return b[a.cd3.x.source]}).right;return c(a.cd3.data,b)},updateScale:function(a){a.cd3.d3graphXAxis.attr("class","x axis").attr("transform","translate(0,"+a.cd3.height+")").call(a.cd3.d3xAxis);
a.cd3.d3graphYAxis.attr("class","y axis").call(a.cd3.d3yAxis)},updateSizing:function(a){},updateDimensions:function(a){a.cd3.width=parseInt(a.style("width"));a.cd3.height=parseInt(a.style("height"));"object"!==typeof a.cd3.margin&&(a.cd3.margin={top:a.cd3.margin,left:a.cd3.margin,right:a.cd3.margin,bottom:a.cd3.margin});a.cd3.width=a.cd3.width-a.cd3.margin.left-a.cd3.margin.right;a.cd3.height=a.cd3.height-a.cd3.margin.top-a.cd3.margin.bottom;a.cd3.tips&&a.cd3.d3TipOverlay&&a.cd3.d3TipOverlay.attr("width",
a.cd3.width).attr("height",a.cd3.height);a.cd3.d3parentSvg.attr("width",a.cd3.width+a.cd3.margin.left+a.cd3.margin.right).attr("height",a.cd3.height+a.cd3.margin.top+a.cd3.margin.bottom);a.cd3.d3graphSvg.attr("width",a.cd3.width).attr("height",a.cd3.height).attr("transform","translate("+a.cd3.margin.left+","+a.cd3.margin.top+")");a.cd3.d3graphTitle&&a.cd3.d3graphTitle.attr("x",a.cd3.width/2).attr("y",a.cd3.margin.top/2).attr("class","title")},tips:function(a){var b=this,c=[],d=a.cd3.d3graphSvg.append("g").attr("class",
"tips");a.cd3.series.forEach(function(a){a.d3Tip=d.append("circle").attr("display","none").attr("r",4.5).attr("class","tip "+a.cssClass);c.push(a.d3Tip)});a.cd3.d3TipOverlay=a.cd3.d3graphSvg.append("rect").attr("class","overlay").attr("width",a.cd3.width).attr("height",a.cd3.height).on("mouseover",function(){a.cd3.d3TipInfo=d3.select("body").append("div").attr("class","cd3 tips");a.cd3.data&&1<a.cd3.data.length&&c.forEach(function(a){a.style("display","block")});a.cd3.d3TipInfo.style("display","block")}).on("mouseout",
function(){a.cd3.data&&1<a.cd3.data.length&&c.forEach(function(a){a.style("display","none")});a.cd3.d3TipInfo.style("display","none")}).on("mousemove",function(){var c=d3.mouse(this);if(!a.cd3.data||1>a.cd3.data.length)return!1;var k=a.cd3.d3xScale.invert(c[0]),d=b.bisectData(a,k),f=a.cd3.data[d-1],g=a.cd3.data[d];if(!f||!g)return!1;var e=g[a.cd3.x.source]-f[a.cd3.x.source],l=(a.cd3.x.title?a.cd3.x.title:a.cd3.x.source)+":"+(a.cd3.x.scale.format?a.cd3.x.scale.format(a.cd3.d3xScale.invert(c[0])):a.cd3.d3xScale.invert(c[0]));
a.cd3.series.forEach(function(b){var d=d3.interpolateNumber(f[b.source],g[b.source])((k-f[a.cd3.x.source])/e);b.d3Tip.attr("cx",c[0]).attr("cy",a.cd3.d3yScale(d));l+=" <span class='"+b.cssClass+" "+b.source+"'>"+(b.title?b.title:b.source)+":"+d.toFixed(2)+"</span>"});d=parseInt(a.style("width"));a.cd3.d3TipInfo.style("top",c[1]+a.cd3.margin.top+10+"px");c[0]>d/2?a.cd3.d3TipInfo.style("right",d-c[0]-a.cd3.margin.right+10+"px").style("left","auto"):a.cd3.d3TipInfo.style("left",c[0]+a.cd3.margin.right+
20+"px").style("right","auto");a.cd3.d3TipInfo.html(l)})},buildPlot:function(a){var b=this,c=a.cd3.d3graphSvg.append("g").attr("class","axes");b.refactorData(a);a.cd3.d3graphXAxis=c.append("g");a.cd3.d3graphYAxis=c.append("g");a.cd3.d3xScale={};a.cd3.d3yScale={};a.cd3.d3xAxis=d3.svg.axis();a.cd3.d3yAxis=d3.svg.axis();switch(a.cd3.x.scale.type){case "time":a.cd3.d3xScale=d3.time.scale();a.cd3.x.scale.format||(a.cd3.x.scale.format="%I:%M:%S");break;default:case "linear":a.cd3.d3xScale=d3.scale.linear();
break;case "ordinal":a.cd3.d3xScale=d3.scale.ordinal()}b.updateDomain(a,"x");b.updateRange(a,"x");a.cd3.d3xAxis.orient(a.cd3.x.axis&&a.cd3.x.axis.orient||"bottom");a.cd3.d3xAxis.scale(a.cd3.d3xScale);a.cd3.x.scale.format&&a.cd3.d3xAxis.tickFormat(d3.time.format(a.cd3.x.scale.format));switch(a.cd3.y.scale.type){case "time":a.cd3.d3yScale=d3.time.scale();a.cd3.y.scale.format||(a.cd3.y.scale.format="%I:%M:%S");a.cd3.d3yScale.tickFormat(d3.time.format(a.cd3.y.scale.format));break;default:case "linear":a.cd3.d3yScale=
d3.scale.linear();break;case "ordinal":a.cd3.d3yScale=d3.scale.ordinal()}b.updateDomain(a,"y");b.updateRange(a,"y");a.cd3.d3yAxis.orient(a.cd3.y.axis&&a.cd3.y.axis.orient||"left");a.cd3.d3yAxis.scale(a.cd3.d3yScale);b.updateScale(a);a.cd3.series.forEach(function(c,h){var k=a.selectAll(".series").append("g").attr("class","series"+(h+1)+" "+c.type+" "+c.source+" "+c.cssClass);"line"==c.type&&k.append("path").attr("stroke",function(a,c){return b.stringToColor("series"+(h+1))});a.cd3.d3graphLegend.html(a.cd3.d3graphLegend.html()+
"<span class='series"+h+" "+c.source+" "+c.cssClass+"'>"+(c.title||"series"+h)+"</span>")});b.updateTicks(a)},buildPie:function(a){a.cd3.d3graphSvg.select("g .series").append("g").attr("class","series0 pie "+a.cd3.series[0].source+" "+a.cd3.series[0].cssClass)},chart:function(a){var b=d3.select(a.selector);b.cd3=a;b.cd3.animate&&b.cd3.animate.ease||(b.cd3.animate.ease="linear");b.cd3.animate&&null!==b.cd3.animate.duration||(b.cd3.animate.duration=200);null===b.cd3.resampling&&(b.cd3.resampling=!0);
b.cd3.d3parentSvg=b.attr("class","cd3").append("svg");b.cd3.d3graphSvg=b.cd3.d3parentSvg.append("g").attr("class","chart").attr("position","relative");b.cd3.d3graphTitle=b.cd3.title?b.cd3.d3parentSvg.append("text").text(b.cd3.title):null;b.cd3.d3graphLegend=b.append("div").attr("class","legend");b.cd3.d3graphSvg.append("g").attr("class","series");b.cd3.tips&&this.tips(b);this.updateDimensions(b);"pie"==b.cd3.series[0].type?this.buildPie(b):this.buildPlot(b);this.list.push(b);this.redrawData(b);return b},
update:function(a,b){a.cd3.data=b;this.redrawData(a)},redrawData:function(a){var b=this;if("pie"==a.cd3.series[0].type){var c=a.select("g.series g.pie"),d=Math.min(a.cd3.width,a.cd3.height)/2;a.cd3.d3graphSvg.select("g .series .pie").attr("transform","translate("+(a.cd3.width-a.cd3.margin.left)/2+","+a.cd3.height/2+")");var d=d3.svg.arc().outerRadius(d),h=d3.layout.pie().value(function(b){return b[a.cd3.series[0].source]}),c=c.selectAll("path.slice");c.data(h(a.cd3.resampling?b.resampleData(a):a.cd3.data)).transition().duration(a.cd3.animate.duration).ease(a.cd3.animate.ease).attr("d",
d);c.data(h(a.cd3.resampling?b.resampleData(a):a.cd3.data)).enter().append("svg:path").attr("fill",function(a,c){return b.stringToColor("category"+c)}).attr("d",d).each(function(a){this._current=a}).attr("class",function(b,c){return"slice category"+c+" "+b.data[a.cd3.series[0].category]});c.data(h(a.cd3.resampling?b.resampleData(a):a.cd3.data)).exit().remove()}else b.updateDomain(a,"x"),b.updateDomain(a,"y"),a.cd3.series.forEach(function(c,d){var f=a.select("g."+c.type+"."+c.source);switch(c.type){default:case "line":var g=
d3.svg.line().x(function(b,c){return a.cd3.d3xScale(b[a.cd3.x.source])}).y(function(b,d){return a.cd3.d3yScale(b[c.source])});f.selectAll("path").data(a.cd3.resampling?b.resampleData(a):[a.cd3.data]).transition().duration(a.cd3.animate.duration).ease(a.cd3.animate.ease).attr("d",g);break;case "bar":case "column":var e=0,e="column"==c.type?"ordinal"==a.cd3.x.scale.type?a.cd3.d3xScale.rangeBand():a.cd3.width/data.length:"ordinal"==a.cd3.y.scale.type?a.cd3.d3yScale.rangeBand():a.cd3.height/data.length,
e=2>e?2:e,g=f.selectAll("rect"),f=b.stringToColor("series"+(d+1));g.data(a.cd3.resampling?b.resampleData(a):a.cd3.data).transition().duration(a.cd3.animate.duration).ease(a.cd3.animate.ease).attr("y",function(b,d){return"column"==c.type?a.cd3.d3yScale(b[c.source]):d*e+1}).attr("x",function(a,b){return"column"==c.type?b*e+1:0}).attr("height",function(b){return"column"==c.type?a.cd3.height-a.cd3.d3yScale(b[c.source]):e-2}).attr("width",function(b){return"column"==c.type?e-2:a.cd3.width-a.cd3.d3xScale(b[c.source])});
g.data(a.cd3.resampling?b.resampleData(a):a.cd3.data).enter().append("rect").attr("fill",f).attr("y",function(b,d){return"column"==c.type?a.cd3.d3yScale(b[c.source]):d*e+1}).attr("x",function(a,b){return"column"==c.type?b*e+1:0}).attr("height",function(b){return"column"==c.type?a.cd3.height-a.cd3.d3yScale(b[c.source]):e-2}).attr("width",function(b){return"column"==c.type?e-2:a.cd3.width-a.cd3.d3xScale(b[c.source])});g.data(a.cd3.resampling?b.resampleData(a):a.cd3.data).exit().remove();break;case "scatter":g=
f.selectAll("circle"),f=b.stringToColor("series"+(d+1)),g.data(a.cd3.resampling?b.resampleData(a):a.cd3.data).transition().duration(a.cd3.animate.duration).ease(a.cd3.animate.ease).attr("cx",function(b){return a.cd3.d3xScale(b[a.cd3.x.source])}).attr("cy",function(b){return a.cd3.d3yScale(b[c.source])}),g.data(a.cd3.resampling?b.resampleData(a):a.cd3.data).enter().append("circle").attr("fill",f).attr("stroke",f).attr("cx",function(b){return a.cd3.d3xScale(b[a.cd3.x.source])}).attr("cy",function(b){return a.cd3.d3yScale(b[c.source])}).attr("r",
2.5),g.data(a.cd3.resampling?b.resampleData(a):a.cd3.data).exit().remove()}}),a.cd3.d3graphYAxis.transition().duration(a.cd3.animate.duration).ease(a.cd3.animate.ease).call(a.cd3.d3yAxis),a.cd3.d3graphXAxis.transition().duration(a.cd3.animate.duration).ease(a.cd3.animate.ease).call(a.cd3.d3xAxis),b.updateTicks(a)},resize:function(){var a=cd3;a.list.forEach(function(b){if(!b.cd3.resizable)return!1;a.updateDimensions(b);"pie"!=b.cd3.series[0].type&&(a.updateRange(b,"x"),a.updateRange(b,"y"),a.updateScale(b));
a.update(b,b.cd3.data)})}};d3.select(window).on("resize",cd3.resize);